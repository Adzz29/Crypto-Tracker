{% extends "base.html" %}
{% block content %}

{# ---------- HEADER ---------- #}
<section class="page-header">
    <h2 class="page-title">Your Portfolio</h2>
    <p class="page-sub">Track your holdings, live prices, and total value at a glance.</p>
    <div class="toolbar">
        <a class="btn btn-gold" href="{{ url_for('add_coin') }}">+ Add Coin</a>
    </div>
</section>

{# ---------- SUMMARY CARDS ---------- #}
{% set ns = namespace(total=0) %}
{% for r in portfolio %}
{% set ns.total = ns.total + (r[4] * (r[5] or 0)) %}
{% endfor %}
<section class="stats stats-centered">
    <div class="stat-box stat-card">
        <h3>${{ '{:,.2f}'.format(ns.total) }}</h3>
        <p>Total Portfolio Value</p>
    </div>
    <div class="stat-box stat-card">
        <h3>{{ portfolio|length }}</h3>
        <p>Coins Tracked</p>
    </div>
    <div class="stat-box stat-card">
        <h3>Live</h3>
        <p>Prices auto-refresh on view</p>
    </div>
</section>

{# ---------- EMPTY STATE ---------- #}
{% if portfolio|length == 0 %}
<section class="card empty-state">
    <div class="empty-left">
        <div class="empty-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" width="64" height="64">
                <rect x="3" y="6" width="18" height="12" rx="3" ry="3" fill="none" stroke="gold" stroke-width="2"/>
                <circle cx="16.5" cy="12" r="2.25" fill="gold"/>
            </svg>
        </div>
        <div>
            <h3 class="empty-title">No coins yet</h3>
            <p class="empty-sub">Add your first holding to see total value, P/L, and live updates.</p>
        </div>
    </div>
    <a href="{{ url_for('add_coin') }}" class="btn btn-gold btn-lg">Add Coin</a>
</section>
{% else %}

{# ---------- TABLE ---------- #}
<section class="card table-wrap">
    <table class="table">
        <thead>
        <tr>
            <th>Name</th>
            <th>Symbol</th>
            <th class="num">Quantity</th>
            <th class="num">Current Price (USD)</th>
            <th class="num">Total Value (USD)</th>
            <th class="act">Action</th>
        </tr>
        </thead>
        <tbody>
        {% for r in portfolio %}
        {% set row_total = (r[4] * (r[5] or 0)) %}
        <tr>
            <td>
                <div class="cell-title">
                    <img
                            src="{{ logo_urls.get(r[1]) or ('https://cryptoicons.org/api/icon/' ~ r[3]|lower ~ '/32') }}"
                            alt="{{ r[2] }} logo"
                            style="vertical-align:middle; margin-right:8px; width:20px; height:20px; border-radius:50%;"
                    />

                    {{ r[2] }}
                </div>
                <div class="cell-sub">ID: {{ r[1] }}</div>
            </td>
            <td><span class="badge">{{ r[3]|upper }}</span></td>
            <td class="num">
                {{ '{:,.8f}'.format(r[4]).rstrip('0').rstrip('.') }}
            </td>
            <td class="num">${{ '{:,.4f}'.format(r[5] or 0) }}</td>
            <td class="num strong">${{ '{:,.2f}'.format(row_total) }}</td>
            <td class="act">
                <a class="link-danger" href="{{ url_for('delete_coin', item_id=r[0]) }}"
                   onclick="return confirm('Remove {{ r[2] }} from portfolio?');">Remove</a>
            </td>
        </tr>
        {% endfor %}
        </tbody>
        <tfoot>
        <tr>
            <th colspan="4" class="num">Grand Total</th>
            <th class="num strong">${{ '{:,.2f}'.format(ns.total) }}</th>
            <th></th>
        </tr>
        </tfoot>
    </table>
</section>

{% endif %}

{% endblock %}
